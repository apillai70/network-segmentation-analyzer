{% extends "base.html" %}

{% block title %}Incremental Learning - Network Segmentation Analyzer{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <h1 class="mb-4">
        <i class="fas fa-brain"></i> Incremental Learning Status
    </h1>

    {% if error %}
    <div class="alert alert-danger">
        <i class="fas fa-exclamation-triangle"></i> {{ error }}
    </div>
    {% endif %}

    {% if stats.status == 'not_enabled' %}
    <div class="alert alert-warning">
        <h4><i class="fas fa-info-circle"></i> Incremental Learning Not Active</h4>
        <p>{{ stats.message }}</p>
        <hr>
        <p>To start incremental learning:</p>
        <pre><code>python start_system.py --incremental --web</code></pre>
    </div>
    {% else %}

    <!-- Statistics Cards -->
    <div class="row">
        <div class="col-md-3 mb-4">
            <div class="card text-white bg-primary">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-file"></i> Files Processed
                    </h5>
                    <h2 class="card-text">{{ stats.total_files_processed or 0 }}</h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-4">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-stream"></i> Flows Analyzed
                    </h5>
                    <h2 class="card-text">{{ (stats.total_flows_processed or 0)|number }}</h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-4">
            <div class="card text-white bg-info">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-cubes"></i> Apps Observed
                    </h5>
                    <h2 class="card-text">{{ stats.apps_observed or 0 }}</h2>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-4">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-sync"></i> Model Updates
                    </h5>
                    <h2 class="card-text">{{ stats.model_updates or 0 }}</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Timeline -->
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Learning Timeline</h5>
                </div>
                <div class="card-body">
                    <table class="table table-sm">
                        <tr>
                            <th>Started:</th>
                            <td>{{ stats.start_time|datetime }}</td>
                        </tr>
                        <tr>
                            <th>Last Update:</th>
                            <td>{{ stats.last_update|datetime }}</td>
                        </tr>
                        <tr>
                            <th>Status:</th>
                            <td><span class="badge bg-success">Active</span></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Chart -->
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Learning Progress</h5>
                </div>
                <div class="card-body">
                    <canvas id="progressChart" width="400" height="100"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- How It Works -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">How Incremental Learning Works</h5>
                </div>
                <div class="card-body">
                    <ol>
                        <li><strong>File Detection:</strong> System monitors <code>data/input/</code> for new <code>App_Code_*.csv</code> files</li>
                        <li><strong>Flow Processing:</strong> Extracts network flows and communication patterns</li>
                        <li><strong>Incremental Update:</strong> Updates models without full retrain (30x faster)</li>
                        <li><strong>Topology Enhancement:</strong> Continuously improves application topology understanding</li>
                        <li><strong>Checkpoint Saving:</strong> Saves progress every 10 updates for recovery</li>
                    </ol>

                    <hr>

                    <h6>Benefits:</h6>
                    <ul>
                        <li>✅ No restart needed when new apps arrive</li>
                        <li>✅ 30x faster than full retraining</li>
                        <li>✅ Continuous model improvement</li>
                        <li>✅ Automatic recovery from checkpoints</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
{% if stats.status != 'not_enabled' %}
// Create progress chart
const ctx = document.getElementById('progressChart').getContext('2d');
const chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: ['Files', 'Flows', 'Apps', 'Updates'],
        datasets: [{
            label: 'Learning Progress',
            data: [
                {{ stats.total_files_processed or 0 }},
                {{ stats.total_flows_processed or 0 }},
                {{ stats.apps_observed or 0 }},
                {{ stats.model_updates or 0 }}
            ],
            borderColor: 'rgb(75, 192, 192)',
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            tension: 0.1
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
{% endif %}
</script>
{% endblock %}
